<!DOCTYPE html><html><head><meta charset="UTF-8"><link rel="stylesheet" href="/mdl/material.min.css"><script src="/mdl/material.min.js"></script><link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons"><link rel="stylesheet" href="https://code.getmdl.io/1.1.3/material.teal-pink.min.css"><link rel="stylesheet" href="/css/layout.css"><link rel="stylesheet" href="/css/post.css"><title>加快墙内网速提升Ubuntu使用效率的TIPS</title></head><body><div class="mdl-layout mdl-js-layout mdl-color--grey-50"><header class="mdl-layout__header mdl-layout--fixed-header"><div class="mdl-layout__header-row"><span class="mdl-layout-title">加快墙内网速提升Ubuntu使用效率的TIPS</span></div></header><div class="mdl-layout__drawer"><span class="mdl-layout-title">Perqin</span><nav class="mdl-navigation"><a href="/" class="mdl-navigation__link mdl-js-ripple-effect">Home</a><a href="/archive" class="mdl-navigation__link">Archive</a><a href="https://github.com/" target="_blank" class="mdl-navigation__link">GitHub</a><a href="http://weibo.com/" target="_blank" class="mdl-navigation__link">Weibo</a></nav></div><main class="mdl-layout__content"><div class="cover-layout mdl-grid"><div class="mdl-cell--bottom"><h2 class="mdl-typography--display-3">Perqin's Blog</h2><h4 class="mdl-typography--display-1">Maintaining...</h4></div></div><div class="mdl-card post-card mdl-shadow--2dp wide-card"><div class="mdl-card__title"><p class="mdl-card__title-text">加快墙内网速提升Ubuntu使用效率的TIPS</p></div><div class="mdl-card__supporting-text"><p>众所周知（？），在国内想要访问某些网站是很慢的，然而也许是误伤的缘故，很多不在此列表的网站访问速度也很慢，shadowsocks的配置方法我已经在<a href="/2016/04/18/ubuntu-reinstallation-series-shadowsocks-configurations/">重装Ubuntu系列：Shadowsocks配置</a>里面提到过，这里再对Ubuntu做一些简单的配置，充分利用已有的资源。</p>
<h1 id="使用npm镜像"><a href="#使用npm镜像" class="headerlink" title="使用npm镜像"></a>使用npm镜像</h1><p>之前从学校回家之后，网络莫名抽风，<code>npm install</code>死活卡着不动，万般无奈之下去谷歌了一下npm的镜像，发现过内有两个镜像，淘宝提供的和cnpm提供的。后者似乎进行了负载均衡，国内用户会通过淘宝的镜像下载（不是很清楚，详见<a href="https://cnpmjs.org/" target="_blank" rel="external">官网</a>），因此选择了它。<br>配置方法还是很简单的，直接在Home目录下新建一个<code>.npmrc</code>的文件，并写入如下内容：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">registry=http://r.cnpmjs.org/</div></pre></td></tr></table></figure></p>
<p>然后重新打开命令行即可。<br>值得一提的是，cnpm还提供了一个<code>cnpm</code>包，用于自动从cnpm镜像下载，不过好像和npm的表现不太一样，所以最终没有用它。</p>
<h1 id="使用教育网apt-get镜像"><a href="#使用教育网apt-get镜像" class="headerlink" title="使用教育网apt-get镜像"></a>使用教育网apt-get镜像</h1><p>这个就不多解释了，直接发车。打开Dash面板搜索<code>Software and Updates</code>，然后打开<code>Ubuntu Software</code>标签页下的<code>Download from:</code>列表，选择<code>&#39;Other...</code>，从弹出的对话框中列表里的China里选择一个即可。</p>
<h1 id="使用国内云服务器和HA-Proxy做Shadowsocks中继"><a href="#使用国内云服务器和HA-Proxy做Shadowsocks中继" class="headerlink" title="使用国内云服务器和HA-Proxy做Shadowsocks中继"></a>使用国内云服务器和HA-Proxy做Shadowsocks中继</h1><p>校园网的环境真是尿崩啊……ping我US的Shadowsocks服务器居然丢包达到了25%，谷歌一番之后，发现了神器HA-Proxy，它可以作为TCP和HTTP的中继，于是我尝试在我的国内云服务器ping我的Shadowsocks服务器，发现延迟在200ms左右，不丢包。从我本地ping国内云服务器，延迟10ms以内，不丢包。可以，很强势！于是，方案浮出水面：在国内云服务器上安装HA-Proxy，将A端口转发到Shadowsocks服务器的B端口，然后将本地的Shadowsocks服务器IP改为国内云服务器IP，端口改为A。</p>
<ul>
<li><p>在国内云服务器安装HA-Proxy</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo apt-get install haproxy</div></pre></td></tr></table></figure>
</li>
<li><p>修改国内云服务器上的<code>/etc/haproxy/haproxy.cfg</code>，将<code>defaults</code>内的<code>mode</code>改为<code>tcp</code>，并在后面添加前后端配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">frontend ss-in</div><div class="line">	bind *:A</div><div class="line">	default_backend ss-out</div><div class="line"></div><div class="line">backend ss-out</div><div class="line">	server server1 1.2.3.4:B maxconn 20480</div></pre></td></tr></table></figure>
</li>
</ul>
<p>   其中1.2.3.4就是你的Shadowsocks服务器IP。</p>
<ul>
<li><p>保存编辑，重启服务</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo service haproxy restart</div></pre></td></tr></table></figure>
</li>
</ul>
<p>客户端的配置略去，需要注意如果有多个端口的话，上述配置文件可以省略端口B。另外，HA-Proxy不支持UDP中继，这可能会造成一些影响，因为Shadowsocks默认开启UDP代理，这可能导致UDP包被丢弃，等我遇到坑了再来田- -</p>
</div><div class="mdl-card__actions"></div></div><div><!-- 多说评论框 start--><div data-thread-key="cirmbi3h90000yb1s067knryd" data-title="加快墙内网速提升Ubuntu使用效率的TIPS" data-url="http://blog.perqin.com/2016/08/09/tips-to-save-your-time-on-ubuntu/" class="ds-thread"></div><!-- 多说评论框 end--></div></main></div><button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--fab mdl-button--accent back-to-top-button"><i class="material-icons">keyboard_arrow_up</i></button><!-- 多说公共JS代码 start (一个网页只需插入一次)--><script type="text/javascript">var duoshuoQuery = {short_name:"perqinblog"};
(function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';
    ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(ds);
})();</script><!-- 多说公共JS代码 end--></body></html>